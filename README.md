# EVE Industry Route Planner (Static GitHub Pages)

This is a 100% static (HTML/CSS/Vanilla JS) industry planner designed to run reliably on GitHub Pages in a stock Chrome install.

## Why blueprint recipes are bundled (and never fetched at runtime)

Two practical constraints drive the architecture:

1) **ESI does not provide full blueprint manufacturing recipes** (bill of materials, manufacturing time, etc.). ESI is great for *live* data (market prices, structures, character data), but the authoritative manufacturing inputs live in the **SDE**.

2) **Fetching SDE data from third‑party APIs directly from the browser is unreliable on GitHub Pages** due to common CORS restrictions and API availability assumptions. When that happens the app shows errors like "Blueprint data not found" even for valid blueprint names.

✅ **Solution:** ship a small, local subset of the SDE (derived offline) in `/data/` and resolve blueprints **entirely locally**. Runtime HTTP is used **only** for market prices.

## What data is included in `/data/`

The app bundles *minimal but sufficient* SDE subsets:

- `data/blueprints.sde.min.json`
  - `blueprintTypeId`
  - `productTypeId` + `productQty`
  - manufacturing `time`
  - `materials`: list of `[typeId, qty]` (per run)

- `data/types.sde.min.json`
  - mapping `typeId → { name, volume (packaged), groupId, categoryId }`
  - includes types needed for bundled blueprints: blueprint items, products, and materials

- `data/name_index.min.json`
  - mapping `normalized name → typeId[]`
  - supports resolving **both blueprint names and product names**

- `data/mock_prices.min.json`
  - small offline price map used when offline (or when a type has no cached live price yet)

### Coverage

The bundled blueprint subset targets common Tech I manufacturing:

- **All Tech I modules** (includes armor/shield mods, weapons, propulsion, ewar, capacitor mods, etc.)
- **All Tech I rigs** (rig groups are in the Module category)
- **All Tech I ammo/charges** (Charge category)
- **All Tech I drones** (Drone category)

The included subset is generated by filtering manufacturing blueprints whose *product* is in one of these categories and requiring **meta group = Tech I** (with a small roman-numeral fallback for rare types missing a meta group).

## Blueprint resolution rules (implemented)

Input is normalized by:

- trim
- lowercase
- collapse repeated whitespace
- accept both `"Blueprint"` suffix and without it

Resolution order:

- If the user enters a **typeID**: match it as blueprintTypeId, then as productTypeId.
- If the user enters a **blueprint name**: resolve directly to a blueprintTypeId using the local name index.
- If the user enters a **product name**: resolve to the product typeId, then map to its manufacturing blueprint using local data.
- If multiple matches exist: **exact** → **startsWith** → **contains**.
- If still not found: show **"Blueprint not included in offline SDE subset"** (never "check connectivity").

✅ Acceptance tests this supports:

- `Multispectrum Energized Membrane I Blueprint` resolves and produces a non-missing row.
- `Multispectrum Energized Membrane I` (product) resolves to the same blueprint.

## Market prices (live + cached)

Market prices are fetched at runtime and cached in `localStorage`:

- Primary: **Fuzzwork market aggregates** (fast bulk lookups)
- Fallback: **ESI region orders** (scans The Forge orders and picks best buy/sell for Jita 4‑4)

Use **Refresh Prices** to force a refresh.

## How to expand / rebuild the SDE subset

The app stays static — you expand data by regenerating the JSON files and committing them.

### Option A (recommended): use EVE Ref reference-data

1) Download the latest `reference-data-latest.tar.xz` from EVE Ref:
   - https://data.everef.net/reference-data/

2) Extract it somewhere.

3) Run the generator:

```bash
python3 tools/build_sde_subset.py --refdata /path/to/extracted/reference-data --outdir data
```

Or point it directly at the tarball:

```bash
python3 tools/build_sde_subset.py --tar reference-data-latest.tar.xz --outdir data
```

4) Commit the regenerated files in `data/`.

### Tweaking coverage

Edit the filter settings in `tools/build_sde_subset.py`:

- `FILTER_PRODUCT_CATEGORIES`
- `FILTER_REQUIRE_META_GROUP_ID`
- `FILTER_EXCLUDE_ROMAN_NUMERALS`

For example, to add ships (category 6) or structures, include those category IDs and re-run.

---

CCP Copyright Notice: EVE Online and the EVE logo are the registered trademarks of CCP hf. All rights are reserved worldwide.
